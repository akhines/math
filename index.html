<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Homeschool Math</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@400;500;600&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body, #root { height: 100%; }
    body { font-family: 'DM Sans', sans-serif; }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useCallback, useEffect, useRef } = React;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // SHARED UTILS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function ri(lo, hi) { return Math.floor(Math.random() * (hi - lo + 1)) + lo; }
    function gcd(a, b) { return b === 0 ? Math.abs(a) : gcd(b, a % b); }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // GRADE STANDARDS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const GRADE_STANDARDS = {
      "K": { label: "Kindergarten", color: "#ff6b6b", standards: [
        { id: "K.OA.1", label: "Addition within 10", type: "addition", lo: 0, hi: 5, maxSum: 10 },
        { id: "K.OA.2", label: "Subtraction within 10", type: "subtraction", lo: 0, hi: 10 },
        { id: "K.NBT.1", label: "Compose numbers 11-19", type: "compose", lo: 11, hi: 19 },
      ]},
      "1": { label: "1st Grade", color: "#ff9f43", standards: [
        { id: "1.OA.6", label: "Addition within 20", type: "addition", lo: 1, hi: 10, maxSum: 20 },
        { id: "1.OA.6b", label: "Subtraction within 20", type: "subtraction", lo: 1, hi: 20 },
        { id: "1.NBT.4", label: "2-digit + 1-digit", type: "addition", lo: 10, hi: 50, lo2: 1, hi2: 9 },
      ]},
      "2": { label: "2nd Grade", color: "#feca57", standards: [
        { id: "2.OA.2", label: "Add within 100", type: "addition", lo: 10, hi: 90 },
        { id: "2.OA.2b", label: "Subtract within 100", type: "subtraction", lo: 10, hi: 100 },
        { id: "2.NBT.5", label: "2-digit addition w/ regrouping", type: "addition", lo: 20, hi: 99 },
        { id: "2.NBT.5b", label: "2-digit subtraction w/ regrouping", type: "subtraction", lo: 20, hi: 99 },
      ]},
      "3": { label: "3rd Grade", color: "#48dbfb", standards: [
        { id: "3.OA.1", label: "Multiplication 0-10", type: "multiplication", lo: 0, hi: 10 },
        { id: "3.OA.2", label: "Division 1-10", type: "division", lo: 1, hi: 10 },
        { id: "3.NBT.2", label: "Add/subtract within 1000", type: "addition", lo: 100, hi: 999 },
        { id: "3.NF.1", label: "Unit fractions (add)", type: "fraction-add", lo: 2, hi: 8 },
      ]},
      "4": { label: "4th Grade", color: "#1dd1a1", standards: [
        { id: "4.OA.4", label: "Multi-digit multiplication", type: "multiplication", lo: 10, hi: 99 },
        { id: "4.NBT.4", label: "Add/subtract large numbers", type: "addition", lo: 1000, hi: 9999 },
        { id: "4.NF.3", label: "Fraction add (like denom.)", type: "fraction-add", lo: 2, hi: 12 },
        { id: "4.NF.4", label: "Fraction multiplication", type: "fraction-mul", lo: 2, hi: 10 },
        { id: "4.NF.6", label: "Decimal addition (tenths)", type: "decimal-add", dp: 1 },
      ]},
      "5": { label: "5th Grade", color: "#54a0ff", standards: [
        { id: "5.NBT.7", label: "Decimal addition (hundredths)", type: "decimal-add", dp: 2 },
        { id: "5.NBT.7b", label: "Decimal subtraction", type: "decimal-sub", dp: 2 },
        { id: "5.NF.1", label: "Fraction add (unlike denom.)", type: "fraction-add", lo: 2, hi: 12 },
        { id: "5.NF.3", label: "Fraction division", type: "fraction-div", lo: 2, hi: 10 },
        { id: "5.NBT.5", label: "Multi-digit multiplication", type: "multiplication", lo: 100, hi: 999 },
      ]},
      "6": { label: "6th Grade", color: "#a29bfe", standards: [
        { id: "6.NS.1", label: "Fraction division", type: "fraction-div", lo: 2, hi: 15 },
        { id: "6.NS.3", label: "Decimal multiplication", type: "decimal-mul", dp: 2 },
        { id: "6.EE.1", label: "Evaluate powers", type: "power", lo: 2, hi: 6 },
        { id: "6.RP.1", label: "Ratio problems", type: "ratio", lo: 1, hi: 12 },
      ]},
      "7": { label: "7th Grade", color: "#fd79a8", standards: [
        { id: "7.NS.1", label: "Add/subtract integers", type: "integer-add", lo: -20, hi: 20 },
        { id: "7.NS.2", label: "Multiply/divide integers", type: "integer-mul", lo: -12, hi: 12 },
        { id: "7.EE.1", label: "Simplify like terms", type: "like-terms", lo: 1, hi: 9 },
        { id: "7.RP.2", label: "Proportional relationships", type: "proportion", lo: 1, hi: 15 },
      ]},
      "8": { label: "8th Grade", color: "#6c5ce7", standards: [
        { id: "8.EE.1", label: "Integer exponents", type: "power", lo: 2, hi: 10 },
        { id: "8.EE.7", label: "One-variable equations", type: "equation", lo: 1, hi: 20 },
        { id: "8.NS.1", label: "Rational vs irrational", type: "classify" },
        { id: "8.F.1", label: "Evaluate functions f(x)", type: "function", lo: 1, hi: 10 },
      ]},
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // WORKSHEET PROBLEM GENERATORS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function genProblem(std) {
      const { type } = std;
      if (type === "addition") {
        const lo2 = std.lo2 ?? std.lo, hi2 = std.hi2 ?? std.hi;
        let a = ri(std.lo, std.hi), b = ri(lo2, hi2);
        if (std.maxSum) { let t = 0; while (a + b > std.maxSum && t++ < 20) { a = ri(std.lo, std.hi); b = ri(lo2, hi2); } }
        return { q: [a, "+", b], ansStr: `${a + b}` };
      }
      if (type === "subtraction") { let a = ri(std.lo, std.hi), b = ri(std.lo, std.hi); if (a < b) [a, b] = [b, a]; return { q: [a, "-", b], ansStr: `${a - b}` }; }
      if (type === "multiplication") { const a = ri(std.lo, std.hi), b = ri(Math.max(std.lo, 2), std.hi); return { q: [a, "x", b], ansStr: `${a * b}` }; }
      if (type === "division") { const b = ri(1, std.hi), a = b * ri(1, 12); return { q: [a, "/", b], ansStr: `${a / b}` }; }
      if (type === "fraction-add" || type === "fraction-sub") {
        let d1 = ri(std.lo, std.hi), d2 = ri(std.lo, std.hi), n1 = ri(1, d1-1), n2 = ri(1, d2-1);
        const lcm = (d1*d2)/gcd(d1,d2), nn1 = n1*(lcm/d1), nn2 = n2*(lcm/d2);
        if (type === "fraction-sub" && nn1 < nn2) [n1,d1,n2,d2]=[n2,d2,n1,d1];
        const rn = type === "fraction-add" ? nn1+nn2 : Math.abs(nn1-nn2), g = gcd(rn,lcm);
        return { q: [`${n1}/${d1}`, type==="fraction-add"?"+":"-", `${n2}/${d2}`], ansStr: `${rn/g}/${lcm/g}` };
      }
      if (type === "fraction-mul") { const d1=ri(std.lo,std.hi),d2=ri(std.lo,std.hi),n1=ri(1,d1-1),n2=ri(1,d2-1),rn=n1*n2,rd=d1*d2,g=gcd(rn,rd); return { q: [`${n1}/${d1}`,"x",`${n2}/${d2}`], ansStr:`${rn/g}/${rd/g}` }; }
      if (type === "fraction-div") { const d1=ri(std.lo,std.hi),d2=ri(std.lo,std.hi),n1=ri(1,d1-1),n2=ri(1,d2-1),rn=n1*d2,rd=d1*n2,g=gcd(rn,rd); return { q: [`${n1}/${d1}`,"/",`${n2}/${d2}`], ansStr:`${rn/g}/${rd/g}` }; }
      if (type === "decimal-add" || type === "decimal-sub") {
        const dp=std.dp??2, f=Math.pow(10,dp); let a=parseFloat((ri(1,99*f)/f).toFixed(dp)), b=parseFloat((ri(1,50*f)/f).toFixed(dp));
        if (type==="decimal-sub"&&a<b)[a,b]=[b,a];
        return { q:[String(a),type==="decimal-add"?"+":"-",String(b)], ansStr:parseFloat((type==="decimal-add"?a+b:a-b).toFixed(dp+1)).toString() };
      }
      if (type === "decimal-mul") { const dp=std.dp??2,f=Math.pow(10,dp),a=parseFloat((ri(1,9*f)/f).toFixed(dp)),b=parseFloat((ri(1,5*f)/f).toFixed(dp)); return { q:[String(a),"x",String(b)], ansStr:parseFloat((a*b).toFixed(dp*2)).toString() }; }
      if (type === "power") { const base=ri(2,std.hi),exp=ri(2,4); return { q:[String(base),"^",String(exp)], ansStr:`${Math.pow(base,exp)}` }; }
      if (type === "integer-add") { const a=ri(std.lo,std.hi),b=ri(std.lo,std.hi); return { q:[String(a),b>=0?"+":"-",String(Math.abs(b))], ansStr:String(a+b) }; }
      if (type === "integer-mul") { const a=ri(std.lo,std.hi),b=ri(std.lo,std.hi); return { q:[String(a),"x",String(b)], ansStr:String(a*b) }; }
      if (type === "equation") { const x=ri(1,std.hi),a=ri(1,10),b=ri(0,20); return { q:[`${a}x + ${b}`,"=",`${a*x+b}`], ansStr:`x = ${x}`, isEquation:true }; }
      if (type === "function") { const a=ri(1,std.hi),b=ri(0,10),xv=ri(1,8); return { q:[`f(x)=${a}x+${b}`,",",`f(${xv})=?`], ansStr:`${a*xv+b}` }; }
      if (type === "ratio") { const a=ri(1,std.hi),b=ri(1,std.hi),k=ri(2,6); return { q:[`${a}:${b}`,"=",`${a*k}:?`], ansStr:`${b*k}` }; }
      if (type === "proportion") { const a=ri(1,std.hi),b=ri(1,std.hi),k=ri(2,5); return { q:[`${a}/${b}`,"=",`?/${b*k}`], ansStr:`${a*k}` }; }
      if (type === "compose") { const n=ri(11,19); return { q:[String(n),"=","10 + ?"], ansStr:`${n-10}` }; }
      if (type === "like-terms") { const a=ri(1,std.hi),b=ri(1,std.hi),c=ri(1,std.hi),d=ri(1,std.hi); return { q:[`${a}x + ${c}`,"+",`${b}x + ${d}`], ansStr:`${a+b}x + ${c+d}` }; }
      if (type === "classify") { const opts=[[4,"rational"],[9,"rational"],[2,"irrational"],[3,"irrational"],[0.5,"rational"],[1.414,"irrational"],[25,"rational"]]; const p=opts[ri(0,opts.length-1)]; return { q:[String(p[0]),"->","rational or irrational?"], ansStr:p[1] }; }
      return { q:["?","+","?"], ansStr:"?" };
    }

    function parseCustomProblem(str) {
      str = str.trim();
      const match = str.match(/^(.+?)\s*([\+\-x\*\/])\s*(.+?)\s*=\s*(.+)$/);
      if (match) return { q: [match[1].trim(), match[2], match[3].trim()], ansStr: match[4].trim(), isCustom: true };
      return { q: [str,"=","?"], ansStr:"?", isCustom:true };
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // PRINT
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function printSheet({ problems, studentName, date, grade, selectedStds, layout, includeAnswerKey }) {
      const gradeInfo = GRADE_STANDARDS[grade];
      const formattedDate = date ? new Date(date+"T12:00:00").toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}) : "";
      const isVert = layout === "vertical";
      const cols = isVert ? 4 : 2;
      const stdList = selectedStds.map(s=>`${s.id}: ${s.label}`).join(" / ");
      const probHTML = problems.map((p,i)=>{
        const [a,op,b]=p.q;
        let inner="";
        if (isVert&&!p.isEquation&&!p.isCustom) {
          const maxLen=Math.max(String(a).length,String(b).length);
          inner=`<pre style="font-family:'Courier New',monospace;font-size:18px;line-height:1.6">${String(a).padStart(maxLen+2)}\n${op+" "+String(b).padStart(maxLen)}\n${"_".repeat(maxLen+3)}</pre>`;
        } else {
          inner=`<span style="font-family:'Courier New',monospace;font-size:17px">${a} ${op} ${b} = ____</span>`;
        }
        return `<div class="prob"><span class="pnum">${i+1}.</span>${inner}</div>`;
      }).join("");
      const keyHTML = problems.map((p,i)=>`<div class="ans"><strong>${i+1}.</strong> <span style="font-family:'Courier New',monospace">${p.q[0]} ${p.q[1]} ${p.q[2]} = <em>${p.ansStr}</em></span></div>`).join("");
      const win=window.open("","_blank");
      if (!win){alert("Please allow popups to print.");return;}
      win.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><title>Math Worksheet</title>
        <style>*{box-sizing:border-box;margin:0;padding:0}body{font-family:Georgia,serif;padding:36px 48px;color:#111}
        .header{display:flex;justify-content:space-between;padding-bottom:12px;border-bottom:3px solid #111;margin-bottom:24px}
        .grade-pill{background:${gradeInfo.color};color:#fff;border-radius:20px;padding:2px 12px;font-size:11px;font-weight:700;text-transform:uppercase;display:inline-block;margin-bottom:5px}
        .title{font-size:26px;font-weight:700}.stds{font-size:10px;color:#888;margin-top:5px}
        .meta{text-align:right;display:flex;flex-direction:column;gap:9px}
        .ml{font-size:12px;display:flex;align-items:center;gap:8px;justify-content:flex-end}
        .mk{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:#aaa}.mv{border-bottom:1.5px solid #ccc;min-width:130px}
        .grid{display:grid;grid-template-columns:repeat(${cols},1fr);gap:${isVert?"28px 20px":"12px 48px"}}
        .prob{padding:${isVert?"12px 6px":"10px 0"};border-bottom:1px dashed #ddd;display:flex;align-items:flex-start;gap:7px}
        .pnum{font-size:10px;color:#bbb;min-width:18px;padding-top:3px}
        .ans-header{margin-top:44px;border-top:2.5px solid #111;padding-top:14px;margin-bottom:18px;display:flex;align-items:center;gap:12px}
        .ans-badge{background:#111;color:#fff;font-size:9px;padding:3px 10px;letter-spacing:1.5px;text-transform:uppercase}
        .ans-title{font-size:20px;font-weight:700}.ans-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px 40px}
        .ans{font-size:13px;padding:5px 0;color:#1a6641;border-bottom:1px dotted #ddd}
        @media print{body{padding:18px 28px}}</style></head><body>
        <div class="header"><div><div class="grade-pill">Grade ${grade} - ${gradeInfo.label}</div>
        <div class="title">Math Worksheet</div><div class="stds">${stdList}</div></div>
        <div class="meta">
          <div class="ml"><span class="mk">Name</span><span class="mv">${studentName||""}</span></div>
          <div class="ml"><span class="mk">Date</span><span class="mv">${formattedDate}</span></div>
          <div class="ml"><span class="mk">Score</span><span class="mv"></span></div>
        </div></div>
        <div class="grid">${probHTML}</div>
        ${includeAnswerKey?`<div class="ans-header"><span class="ans-badge">ANSWER KEY</span><span class="ans-title">Solutions</span></div><div class="ans-grid">${keyHTML}</div>`:""}
        <script>window.onload=()=>{window.print();}<\/script></body></html>`);
      win.document.close();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MATH FACT GAME
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const GAME_MODES = [
      { id:"addition",       label:"Addition",       op:"+", color:"#ff9f43", emoji:"+" },
      { id:"subtraction",    label:"Subtraction",    op:"-", color:"#ff6b6b", emoji:"-" },
      { id:"multiplication", label:"Multiplication", op:"x", color:"#54a0ff", emoji:"x" },
      { id:"division",       label:"Division",       op:"/", color:"#1dd1a1", emoji:"/" },
    ];

    function genGameProblem(mode, level) {
      const max = [0,5,10,12,20][level];
      if (mode==="addition"){const a=ri(0,max),b=ri(0,max);return{q:`${a} + ${b}`,ans:a+b};}
      if (mode==="subtraction"){let a=ri(0,max),b=ri(0,max);if(a<b)[a,b]=[b,a];return{q:`${a} - ${b}`,ans:a-b};}
      if (mode==="multiplication"){const a=ri(0,max),b=ri(0,max);return{q:`${a} x ${b}`,ans:a*b};}
      if (mode==="division"){const b=ri(1,max),a=b*ri(1,max);return{q:`${a} / ${b}`,ans:a/b};}
    }

    function MathGame() {
      const [screen, setScreen] = useState("setup");
      const [mode, setMode] = useState("multiplication");
      const [level, setLevel] = useState(2);
      const [totalQ, setTotalQ] = useState(10);
      const [timeMode, setTimeMode] = useState(false);
      const [totalTime, setTotalTime] = useState(60);
      const [problem, setProblem] = useState(null);
      const [input, setInput] = useState("");
      const [score, setScore] = useState(0);
      const [qNum, setQNum] = useState(0);
      const [feedback, setFeedback] = useState(null);
      const [timeLeft, setTimeLeft] = useState(0);
      const [results, setResults] = useState([]);
      const [streak, setStreak] = useState(0);
      const [bestStreak, setBestStreak] = useState(0);
      const [showFeedback, setShowFeedback] = useState(false);
      const inputRef = useRef(null);
      const timerRef = useRef(null);
      const modeInfo = GAME_MODES.find(m=>m.id===mode);

      const nextProblem = useCallback(()=>{
        setProblem(genGameProblem(mode, level));
        setInput(""); setFeedback(null); setShowFeedback(false);
        setTimeout(()=>inputRef.current?.focus(),50);
      },[mode,level]);

      const startGame = ()=>{
        setScore(0);setQNum(0);setResults([]);setStreak(0);setBestStreak(0);
        setProblem(genGameProblem(mode,level));setInput("");setFeedback(null);setShowFeedback(false);
        if(timeMode)setTimeLeft(totalTime);
        setScreen("playing");
        setTimeout(()=>inputRef.current?.focus(),100);
      };

      useEffect(()=>{
        if(screen==="playing"&&timeMode){
          timerRef.current=setInterval(()=>{
            setTimeLeft(t=>{if(t<=1){clearInterval(timerRef.current);setScreen("results");return 0;}return t-1;});
          },1000);
        }
        return()=>clearInterval(timerRef.current);
      },[screen,timeMode]);

      const submit = ()=>{
        if(!problem||input==="")return;
        const userAns=parseFloat(input);
        const correct=userAns===problem.ans;
        const newStreak=correct?streak+1:0;
        setStreak(newStreak);
        setBestStreak(b=>Math.max(b,newStreak));
        setFeedback(correct?"correct":"wrong");
        setShowFeedback(true);
        setResults(r=>[...r,{q:problem.q,ans:problem.ans,userAns,correct}]);
        if(correct)setScore(s=>s+1);
        const nextQNum=qNum+1;
        setQNum(nextQNum);
        if(!timeMode&&nextQNum>=totalQ){setTimeout(()=>setScreen("results"),700);}
        else{setTimeout(()=>nextProblem(),correct?450:1000);}
      };

      const accuracy = results.length>0?Math.round((results.filter(r=>r.correct).length/results.length)*100):0;
      const progress = timeMode?(timeLeft/totalTime)*100:(qNum/totalQ)*100;

      if(screen==="setup") return(
        <div style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"30px 20px",background:"#f5f1eb",overflowY:"auto"}}>
          <div style={{background:"#fff",borderRadius:20,padding:"36px 40px",width:"100%",maxWidth:480,boxShadow:"0 4px 32px rgba(0,0,0,.08)"}}>
            <div style={{fontFamily:"'DM Serif Display',serif",fontSize:30,color:"#1a1a2e",marginBottom:4}}>Math Fact Practice</div>
            <div style={{fontSize:13,color:"#aaa",marginBottom:28}}>Fast-paced drill to build fluency</div>

            <div style={{fontSize:9,letterSpacing:"2px",textTransform:"uppercase",color:"#bbb",marginBottom:10}}>Operation</div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:22}}>
              {GAME_MODES.map(m=>(
                <button key={m.id} onClick={()=>setMode(m.id)} style={{padding:"16px 10px",borderRadius:12,border:`2px solid ${mode===m.id?m.color:"#ebe7e0"}`,background:mode===m.id?m.color+"18":"#f9f7f4",cursor:"pointer",textAlign:"center",color:mode===m.id?m.color:"#666",transition:"all .15s"}}>
                  <div style={{fontFamily:"'Courier Prime',monospace",fontSize:28,fontWeight:700}}>{m.emoji}</div>
                  <div style={{fontFamily:"'DM Sans',sans-serif",fontSize:13,fontWeight:600,marginTop:4}}>{m.label}</div>
                </button>
              ))}
            </div>

            <div style={{fontSize:9,letterSpacing:"2px",textTransform:"uppercase",color:"#bbb",marginBottom:10}}>Difficulty</div>
            <div style={{display:"flex",gap:6,marginBottom:22}}>
              {[[1,"Easy"],[2,"Medium"],[3,"Hard"],[4,"Expert"]].map(([l,lbl])=>(
                <button key={l} onClick={()=>setLevel(l)} style={{flex:1,padding:"9px 0",borderRadius:8,border:`1.5px solid ${level===l?"#1a1a2e":"#ebe7e0"}`,background:level===l?"#1a1a2e":"#f5f1eb",color:level===l?"#fff":"#888",fontSize:11,cursor:"pointer",fontWeight:level===l?600:400}}>{lbl}</button>
              ))}
            </div>

            <div style={{fontSize:9,letterSpacing:"2px",textTransform:"uppercase",color:"#bbb",marginBottom:10}}>Mode</div>
            <div style={{display:"flex",gap:8,marginBottom:18}}>
              <button onClick={()=>setTimeMode(false)} style={{flex:1,padding:"9px 0",borderRadius:8,border:`1.5px solid ${!timeMode?"#1a1a2e":"#ebe7e0"}`,background:!timeMode?"#1a1a2e":"#f5f1eb",color:!timeMode?"#fff":"#888",fontSize:12,cursor:"pointer",fontWeight:!timeMode?600:400}}>Questions</button>
              <button onClick={()=>setTimeMode(true)} style={{flex:1,padding:"9px 0",borderRadius:8,border:`1.5px solid ${timeMode?"#1a1a2e":"#ebe7e0"}`,background:timeMode?"#1a1a2e":"#f5f1eb",color:timeMode?"#fff":"#888",fontSize:12,cursor:"pointer",fontWeight:timeMode?600:400}}>Timed</button>
            </div>

            {!timeMode?(
              <div style={{marginBottom:22}}>
                <div style={{fontSize:9,letterSpacing:"2px",textTransform:"uppercase",color:"#bbb",marginBottom:10}}>Questions: {totalQ}</div>
                <input type="range" min={5} max={30} step={5} value={totalQ} onChange={e=>setTotalQ(Number(e.target.value))} style={{width:"100%",accentColor:modeInfo.color}} />
              </div>
            ):(
              <div style={{marginBottom:22}}>
                <div style={{fontSize:9,letterSpacing:"2px",textTransform:"uppercase",color:"#bbb",marginBottom:10}}>Time Limit</div>
                <div style={{display:"flex",gap:8}}>
                  {[30,60,90,120].map(t=>(
                    <button key={t} onClick={()=>setTotalTime(t)} style={{flex:1,padding:"9px 0",borderRadius:8,border:`1.5px solid ${totalTime===t?"#1a1a2e":"#ebe7e0"}`,background:totalTime===t?"#1a1a2e":"#f5f1eb",color:totalTime===t?"#fff":"#888",fontSize:11,cursor:"pointer",fontWeight:totalTime===t?600:400}}>{t}s</button>
                  ))}
                </div>
              </div>
            )}

            <button onClick={startGame} style={{width:"100%",padding:15,background:modeInfo.color,color:"#fff",border:"none",borderRadius:12,fontFamily:"'DM Serif Display',serif",fontSize:20,cursor:"pointer",letterSpacing:.3}}>
              Start Practice
            </button>
          </div>
        </div>
      );

      if(screen==="playing") return(
        <div style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"30px 20px",background:"#f5f1eb"}}>
          <div style={{background:"#fff",borderRadius:20,padding:"36px 40px",width:"100%",maxWidth:440,boxShadow:"0 4px 32px rgba(0,0,0,.08)",textAlign:"center"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
              <div style={{fontSize:13,color:"#aaa",fontWeight:500}}>
                {timeMode?`${timeLeft}s left`:`${qNum} / ${totalQ}`}
              </div>
              <div style={{display:"flex",gap:14,fontSize:13}}>
                <span style={{color:"#1dd1a1",fontWeight:700}}>+{score} correct</span>
                {streak>=3&&<span style={{color:"#feca57",fontWeight:700}}>x{streak} streak</span>}
              </div>
            </div>

            <div style={{height:6,background:"#f0ece6",borderRadius:6,overflow:"hidden",marginBottom:28}}>
              <div style={{height:"100%",width:`${Math.min(progress,100)}%`,background:modeInfo.color,borderRadius:6,transition:"width .3s"}}></div>
            </div>

            <div style={{fontFamily:"'Courier Prime',monospace",fontSize:56,fontWeight:700,color:"#1a1a2e",lineHeight:1.1,marginBottom:8}}>{problem?.q}</div>
            <div style={{fontSize:22,color:"#ccc",marginBottom:24}}>= ?</div>

            <div style={{position:"relative",marginBottom:14}}>
              {showFeedback&&(
                <div style={{position:"absolute",top:-36,left:"50%",transform:"translateX(-50%)",background:feedback==="correct"?modeInfo.color:"#ff6b6b",color:"#fff",borderRadius:20,padding:"4px 18px",fontSize:14,fontWeight:700,whiteSpace:"nowrap",zIndex:10}}>
                  {feedback==="correct"?"Correct!":problem?`Answer: ${problem.ans}`:""}
                </div>
              )}
              <input
                ref={inputRef}
                type="number"
                value={input}
                onChange={e=>setInput(e.target.value)}
                onKeyDown={e=>e.key==="Enter"&&submit()}
                disabled={!!feedback}
                placeholder="?"
                style={{width:"100%",textAlign:"center",fontFamily:"'Courier Prime',monospace",fontSize:44,fontWeight:700,border:`3px solid ${feedback==="correct"?modeInfo.color:feedback==="wrong"?"#ff6b6b":"#ebe7e0"}`,borderRadius:14,padding:"14px",outline:"none",color:"#1a1a2e",background:feedback==="correct"?modeInfo.color+"12":feedback==="wrong"?"#fff0f0":"#fff",transition:"all .2s"}}
              />
            </div>

            <button onClick={submit} disabled={!!feedback||input===""} style={{width:"100%",padding:13,background:input&&!feedback?modeInfo.color:"#ccc",color:"#fff",border:"none",borderRadius:10,fontFamily:"'DM Serif Display',serif",fontSize:18,cursor:input&&!feedback?"pointer":"default",transition:"background .15s"}}>
              Submit
            </button>
            <button onClick={()=>{clearInterval(timerRef.current);setScreen("setup");}} style={{marginTop:10,background:"none",border:"none",color:"#bbb",fontSize:12,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"}}>Quit</button>
          </div>
        </div>
      );

      if(screen==="results") return(
        <div style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"30px 20px",background:"#f5f1eb",overflowY:"auto"}}>
          <div style={{background:"#fff",borderRadius:20,padding:"36px 40px",width:"100%",maxWidth:480,boxShadow:"0 4px 32px rgba(0,0,0,.08)"}}>
            <div style={{textAlign:"center",marginBottom:24}}>
              <div style={{fontSize:52,marginBottom:10}}>{accuracy>=90?"ğŸ†":accuracy>=70?"â­":"ğŸ’ª"}</div>
              <div style={{fontFamily:"'DM Serif Display',serif",fontSize:28,color:"#1a1a2e"}}>{accuracy>=90?"Amazing!":accuracy>=70?"Great job!":"Keep practicing!"}</div>
              <div style={{fontSize:13,color:"#aaa",marginTop:4}}>{modeInfo.label}</div>
            </div>

            <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:24,textAlign:"center"}}>
              {[[score,"Correct","#1dd1a1"],[results.length-score,"Wrong","#ff6b6b"],[accuracy+"%","Accuracy",modeInfo.color],[bestStreak,"Best Streak","#feca57"]].map(([val,lbl,col])=>(
                <div key={lbl} style={{background:"#f9f7f4",borderRadius:12,padding:"14px 8px"}}>
                  <div style={{fontFamily:"'DM Serif Display',serif",fontSize:28,color:col}}>{val}</div>
                  <div style={{fontSize:10,color:"#aaa",textTransform:"uppercase",letterSpacing:1,marginTop:2}}>{lbl}</div>
                </div>
              ))}
            </div>

            <div style={{fontSize:10,letterSpacing:"2px",textTransform:"uppercase",color:"#bbb",marginBottom:8}}>Review</div>
            <div style={{maxHeight:180,overflowY:"auto",display:"flex",flexDirection:"column",gap:4,marginBottom:20}}>
              {results.map((r,i)=>(
                <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"6px 12px",borderRadius:8,background:r.correct?"#e8f8f0":"#fff0f0",fontSize:13,fontFamily:"'Courier Prime',monospace"}}>
                  <span>{r.q} = {r.ans}</span>
                  <span style={{color:r.correct?"#1dd1a1":"#ff6b6b"}}>{r.correct?"Correct":`You said ${r.userAns}`}</span>
                </div>
              ))}
            </div>

            <button onClick={startGame} style={{width:"100%",padding:14,background:modeInfo.color,color:"#fff",border:"none",borderRadius:12,fontFamily:"'DM Serif Display',serif",fontSize:18,cursor:"pointer",marginBottom:8}}>Play Again</button>
            <button onClick={()=>setScreen("setup")} style={{width:"100%",padding:10,background:"none",border:"1.5px solid #ebe7e0",borderRadius:10,color:"#888",fontSize:13,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"}}>Change Settings</button>
          </div>
        </div>
      );

      return null;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // WORKSHEET APP
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function WorksheetApp() {
      const [grade, setGrade] = useState("3");
      const [selectedStdIds, setSelectedStdIds] = useState(["3.OA.1"]);
      const [numProblems, setNumProblems] = useState(20);
      const [layout, setLayout] = useState("horizontal");
      const [studentName, setStudentName] = useState("");
      const [date, setDate] = useState(new Date().toISOString().split("T")[0]);
      const [includeAnswerKey, setIncludeAnswerKey] = useState(true);
      const [customInput, setCustomInput] = useState("");
      const [customProblems, setCustomProblems] = useState([]);
      const [problems, setProblems] = useState(null);
      const [activeTab, setActiveTab] = useState("worksheet");

      const gradeInfo = GRADE_STANDARDS[grade];
      const selectedStds = gradeInfo.standards.filter(s=>selectedStdIds.includes(s.id));

      const handleGradeChange = (g)=>{setGrade(g);setSelectedStdIds([GRADE_STANDARDS[g].standards[0].id]);setProblems(null);};
      const toggleStd = (id)=>setSelectedStdIds(prev=>prev.includes(id)?(prev.length>1?prev.filter(x=>x!==id):prev):[...prev,id]);
      const addCustomProblems = ()=>{ if(!customInput.trim())return; setCustomProblems(prev=>[...prev,...customInput.split("\n").map(l=>l.trim()).filter(Boolean).map(parseCustomProblem)]); setCustomInput(""); };
      const removeCustom = (i)=>setCustomProblems(prev=>prev.filter((_,idx)=>idx!==i));

      const generate = useCallback(()=>{
        if(!selectedStds.length&&!customProblems.length)return;
        const list=[];
        const slots=Math.max(0,numProblems-Math.min(customProblems.length,numProblems));
        for(let i=0;i<slots;i++)list.push(genProblem(selectedStds[i%selectedStds.length]));
        customProblems.slice(0,numProblems).forEach(cp=>list.push(cp));
        for(let i=list.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[list[i],list[j]]=[list[j],list[i]];}
        setProblems(list.slice(0,numProblems));
        setActiveTab("worksheet");
      },[selectedStds,customProblems,numProblems]);

      const renderProblem = (p,i)=>{
        const [a,op,b]=p.q;
        const isVert=layout==="vertical";
        const opDisplay = {"+":"+","-":"âˆ’","x":"Ã—","/":"Ã·","^":"^","=":"=","->":"â†’",",":","};
        return(
          <div key={i} style={{padding:isVert?"14px 6px":"11px 0",borderBottom:"1px dashed #e4dfd6",display:"flex",alignItems:"flex-start",gap:8}}>
            <span style={{fontSize:10,color:"#bbb",minWidth:22,marginTop:4}}>{i+1}.</span>
            {isVert&&!p.isEquation&&!p.isCustom?(
              <div style={{fontFamily:"'Courier Prime','Courier New',monospace",fontSize:18,lineHeight:1.6,textAlign:"right"}}>
                <div>{a}</div>
                <div style={{borderBottom:"2px solid #1a1a2e",paddingBottom:2}}>{opDisplay[op]||op}&nbsp;{b}</div>
                <div style={{color:"#ccc",fontSize:11,marginTop:4,letterSpacing:3}}>_______</div>
              </div>
            ):(
              <div style={{fontFamily:"'Courier Prime','Courier New',monospace",fontSize:17}}>
                {a} <span style={{color:"#e17055",fontWeight:700}}>{opDisplay[op]||op}</span> {b} = <span style={{color:"#ccc"}}>____</span>
              </div>
            )}
            {p.isCustom&&<span style={{fontSize:9,color:"#a29bfe",marginTop:5}}>*</span>}
          </div>
        );
      };

      const formattedDate=date?new Date(date+"T12:00:00").toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"";
      const iStyle={border:"1.5px solid #ebe7e0",borderRadius:7,padding:"8px 10px",fontFamily:"'DM Sans',sans-serif",fontSize:13,background:"#f5f1eb",outline:"none",color:"#1a1a2e",width:"100%"};

      return(
        <div style={{display:"flex",flex:1,overflow:"hidden"}}>
          <aside style={{width:300,background:"#fff",borderRight:"1px solid #ebe7e0",padding:"20px 18px",overflowY:"auto",display:"flex",flexDirection:"column",gap:20}}>

            <div>
              <div style={{fontSize:9,letterSpacing:"2.5px",textTransform:"uppercase",color:"#bbb",marginBottom:9}}>Grade Level</div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>
                {Object.entries(GRADE_STANDARDS).map(([g,info])=>(
                  <button key={g} onClick={()=>handleGradeChange(g)} style={{borderRadius:9,border:`1.5px solid ${grade===g?"transparent":"#ebe7e0"}`,background:grade===g?info.color:"#f5f1eb",padding:"8px 4px",fontFamily:"'DM Serif Display',serif",fontSize:16,cursor:"pointer",textAlign:"center",color:grade===g?"#fff":"#555",lineHeight:1.1}}>
                    {g}<span style={{fontSize:8,fontFamily:"'DM Sans',sans-serif",color:grade===g?"rgba(255,255,255,0.7)":"#aaa",display:"block",marginTop:1}}>{g==="K"?"Kinder":"Grade"}</span>
                  </button>
                ))}
              </div>
            </div>

            <div>
              <div style={{fontSize:9,letterSpacing:"2.5px",textTransform:"uppercase",color:"#bbb",marginBottom:9}}>{gradeInfo.label} Standards</div>
              <div style={{display:"flex",flexDirection:"column",gap:5}}>
                {gradeInfo.standards.map(std=>{
                  const sel=selectedStdIds.includes(std.id);
                  return(
                    <div key={std.id} onClick={()=>toggleStd(std.id)} style={{display:"flex",alignItems:"flex-start",gap:9,padding:"8px 10px",border:`1.5px solid ${sel?"#1a1a2e":"#ebe7e0"}`,borderRadius:9,cursor:"pointer",fontSize:12,background:sel?"#1a1a2e":"#f9f7f4",color:sel?"#f5f1eb":"#444",userSelect:"none",lineHeight:1.4}}>
                      <div style={{width:15,height:15,borderRadius:4,border:"1.5px solid currentColor",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,flexShrink:0,marginTop:2}}>{sel?"âœ“":""}</div>
                      <div><span style={{fontSize:9,fontWeight:700,letterSpacing:".8px",opacity:.65,fontFamily:"'Courier Prime',monospace",display:"block",marginBottom:1}}>{std.id}</span>{std.label}</div>
                    </div>
                  );
                })}
              </div>
            </div>

            <div>
              <div style={{fontSize:9,letterSpacing:"2.5px",textTransform:"uppercase",color:"#bbb",marginBottom:9}}>Student Info</div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                <div style={{display:"flex",flexDirection:"column",gap:5}}><label style={{fontSize:11,color:"#999"}}>Name</label><input style={iStyle} type="text" placeholder="Student name" value={studentName} onChange={e=>setStudentName(e.target.value)} /></div>
                <div style={{display:"flex",flexDirection:"column",gap:5}}><label style={{fontSize:11,color:"#999"}}>Date</label><input style={iStyle} type="date" value={date} onChange={e=>setDate(e.target.value)} /></div>
              </div>
            </div>

            <div>
              <div style={{fontSize:9,letterSpacing:"2.5px",textTransform:"uppercase",color:"#bbb",marginBottom:9}}>Problem Layout</div>
              <div style={{display:"flex",border:"1.5px solid #ebe7e0",borderRadius:8,overflow:"hidden"}}>
                <button onClick={()=>setLayout("horizontal")} style={{flex:1,padding:"8px 0",border:"none",background:layout==="horizontal"?"#1a1a2e":"#f5f1eb",color:layout==="horizontal"?"#fff":"#777",fontSize:12,cursor:"pointer",fontWeight:layout==="horizontal"?600:400}}>Horizontal</button>
                <button onClick={()=>setLayout("vertical")} style={{flex:1,padding:"8px 0",border:"none",background:layout==="vertical"?"#1a1a2e":"#f5f1eb",color:layout==="vertical"?"#fff":"#777",fontSize:12,cursor:"pointer",fontWeight:layout==="vertical"?600:400}}>Vertical</button>
              </div>
            </div>

            <div>
              <div style={{fontSize:9,letterSpacing:"2.5px",textTransform:"uppercase",color:"#bbb",marginBottom:9}}>Problems: {numProblems}</div>
              <input type="range" min={5} max={40} step={5} value={numProblems} onChange={e=>setNumProblems(Number(e.target.value))} style={{width:"100%",accentColor:"#1a1a2e"}} />
            </div>

            <div>
              <div style={{fontSize:9,letterSpacing:"2.5px",textTransform:"uppercase",color:"#bbb",marginBottom:9}}>Custom Problems</div>
              <textarea onChange={e=>setCustomInput(e.target.value)} value={customInput} placeholder={"12 + 7 = 19\n6 x 8 = 48"} style={{...iStyle,fontFamily:"'Courier Prime',monospace",fontSize:12,resize:"vertical",minHeight:64}} />
              <button onClick={addCustomProblems} style={{width:"100%",padding:8,border:"1.5px dashed #a29bfe",borderRadius:8,background:"transparent",color:"#6c5ce7",fontFamily:"'DM Sans',sans-serif",fontSize:12,cursor:"pointer",marginTop:4}}>+ Add to Pool</button>
              {customProblems.length>0&&(
                <div style={{display:"flex",flexDirection:"column",gap:4,maxHeight:100,overflowY:"auto",marginTop:6}}>
                  {customProblems.map((cp,i)=>(
                    <div key={i} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 9px",background:"#edeaff",borderRadius:6,fontFamily:"'Courier Prime',monospace",fontSize:11,color:"#4a3f9a",gap:6}}>
                      <span style={{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{cp.q[0]} {cp.q[1]} {cp.q[2]} = {cp.ansStr}</span>
                      <button onClick={()=>removeCustom(i)} style={{background:"none",border:"none",color:"#bbb",cursor:"pointer",fontSize:15,lineHeight:1,padding:0}}>x</button>
                    </div>
                  ))}
                </div>
              )}
            </div>

            <div>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:12,color:"#666",cursor:"pointer",userSelect:"none"}} onClick={()=>setIncludeAnswerKey(v=>!v)}>
                <span>Include answer key in PDF</span>
                <div style={{width:36,height:20,borderRadius:10,background:includeAnswerKey?"#1a1a2e":"#ddd",position:"relative",transition:"background .2s",flexShrink:0}}>
                  <div style={{position:"absolute",top:3,left:includeAnswerKey?19:3,width:14,height:14,borderRadius:"50%",background:"#fff",transition:"left .2s",boxShadow:"0 1px 3px rgba(0,0,0,.2)"}}></div>
                </div>
              </div>
            </div>

            <button onClick={generate} disabled={!selectedStds.length&&!customProblems.length} style={{width:"100%",padding:13,background:"#e17055",color:"#fff",border:"none",borderRadius:10,fontFamily:"'DM Serif Display',serif",fontSize:17,cursor:"pointer",marginTop:4}}>
              Generate Worksheet
            </button>
          </aside>

          <main style={{flex:1,padding:"26px 30px",overflowY:"auto",display:"flex",flexDirection:"column",gap:16}}>
            {!problems?(
              <div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,color:"#ccc",textAlign:"center",minHeight:300}}>
                <span style={{fontSize:50}}>ğŸ§®</span>
                <div style={{fontFamily:"'DM Serif Display',serif",fontSize:22}}>Choose a grade and standards</div>
                <div style={{fontSize:13}}>Then click Generate to preview your worksheet</div>
              </div>
            ):(
              <>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:10}}>
                  <div style={{display:"flex",border:"1.5px solid #ebe7e0",borderRadius:8,overflow:"hidden"}}>
                    <button onClick={()=>setActiveTab("worksheet")} style={{padding:"7px 18px",background:activeTab==="worksheet"?"#1a1a2e":"none",border:"none",fontFamily:"'DM Sans',sans-serif",fontSize:12,cursor:"pointer",color:activeTab==="worksheet"?"#f5f1eb":"#999",borderRight:"1px solid #ebe7e0"}}>Worksheet</button>
                    <button onClick={()=>setActiveTab("answers")} style={{padding:"7px 18px",background:activeTab==="answers"?"#1a1a2e":"none",border:"none",fontFamily:"'DM Sans',sans-serif",fontSize:12,cursor:"pointer",color:activeTab==="answers"?"#f5f1eb":"#999"}}>Answer Key</button>
                  </div>
                  <button onClick={()=>printSheet({problems,studentName,date,grade,selectedStds,layout,includeAnswerKey})} style={{padding:"8px 20px",background:"#1a1a2e",color:"#f5f1eb",border:"none",borderRadius:8,fontFamily:"'DM Sans',sans-serif",fontSize:12,cursor:"pointer",display:"flex",alignItems:"center",gap:7}}>
                    Print / Save PDF
                  </button>
                </div>

                <div style={{background:"#fff",border:"1px solid #ebe7e0",borderRadius:14,padding:"28px 30px",boxShadow:"0 2px 16px rgba(0,0,0,.04)"}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",borderBottom:"2.5px solid #1a1a2e",paddingBottom:12,marginBottom:22,gap:16,flexWrap:"wrap"}}>
                    <div>
                      <div style={{display:"inline-flex",alignItems:"center",gap:6,borderRadius:20,padding:"2px 12px 2px 8px",fontSize:10,fontWeight:600,letterSpacing:1,textTransform:"uppercase",marginBottom:4,background:gradeInfo.color+"22",color:gradeInfo.color}}>
                        <span style={{width:7,height:7,borderRadius:"50%",background:gradeInfo.color,display:"inline-block"}}></span>
                        Grade {grade} - {gradeInfo.label}
                      </div>
                      <div style={{fontFamily:"'DM Serif Display',serif",fontSize:24}}>Math Worksheet</div>
                      <div style={{fontSize:10,color:"#aaa",marginTop:4,lineHeight:1.8,maxWidth:360}}>
                        {selectedStds.map((st,i)=>(
                          <span key={st.id}><span style={{fontFamily:"'Courier Prime',monospace",fontWeight:700,fontSize:10}}>{st.id}</span>{" "}{st.label}{i<selectedStds.length-1?" / ":""}</span>
                        ))}
                        {customProblems.length>0&&<span style={{color:"#a29bfe",fontWeight:600}}> + {customProblems.length} custom</span>}
                      </div>
                    </div>
                    <div style={{textAlign:"right",display:"flex",flexDirection:"column",gap:8,flexShrink:0}}>
                      {[["Name",studentName||""],["Date",formattedDate],["Score",""]].map(([lbl,val])=>(
                        <div key={lbl} style={{fontSize:12,display:"flex",alignItems:"center",gap:7,justifyContent:"flex-end"}}>
                          <span style={{fontSize:9,textTransform:"uppercase",letterSpacing:1,color:"#aaa"}}>{lbl}</span>
                          <span style={{borderBottom:"1px solid #ddd",minWidth:120,fontSize:12,paddingBottom:1,color:"#333"}}>{val}</span>
                        </div>
                      ))}
                    </div>
                  </div>

                  {activeTab==="worksheet"?(
                    <div style={{display:"grid",gridTemplateColumns:layout==="vertical"?"repeat(4,1fr)":"1fr 1fr",gap:layout==="vertical"?"0 16px":"0 48px"}}>
                      {problems.map((p,i)=>renderProblem(p,i))}
                    </div>
                  ):(
                    <>
                      <div style={{marginTop:32,borderTop:"2.5px solid #1a1a2e",paddingTop:12,marginBottom:14,display:"flex",alignItems:"center",gap:10}}>
                        <span style={{background:"#1a1a2e",color:"#f5f1eb",fontSize:9,padding:"3px 10px",letterSpacing:"1.5px",textTransform:"uppercase"}}>Answer Key</span>
                        <span style={{fontFamily:"'DM Serif Display',serif",fontSize:18}}>Solutions</span>
                      </div>
                      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px 36px"}}>
                        {problems.map((p,i)=>(
                          <div key={i} style={{fontFamily:"'Courier Prime',monospace",fontSize:13,padding:"5px 0",color:"#1a6641",borderBottom:"1px dotted #e4dfd6"}}>
                            <strong>{i+1}.</strong> {p.q[0]} {p.q[1]} {p.q[2]} = <em>{p.ansStr}</em>
                          </div>
                        ))}
                      </div>
                    </>
                  )}
                </div>
                <div style={{fontSize:11,color:"#bbb",textAlign:"center",padding:"6px 0"}}>Click Generate again for a fresh set</div>
              </>
            )}
          </main>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MAIN APP WITH NAVIGATION
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function App() {
      const [page, setPage] = useState("worksheet");

      return(
        <div style={{height:"100vh",background:"#f5f1eb",display:"flex",flexDirection:"column",overflow:"hidden"}}>
          <div style={{background:"#1a1a2e",color:"#f5f1eb",padding:"0 28px",display:"flex",alignItems:"stretch",gap:0,flexShrink:0}}>
            <div style={{display:"flex",alignItems:"center",gap:10,paddingRight:28,borderRight:"1px solid rgba(255,255,255,.08)"}}>
              <span style={{fontSize:20}}>ğŸ“š</span>
              <div>
                <div style={{fontFamily:"'DM Serif Display',serif",fontSize:18}}>Homeschool Math</div>
              </div>
            </div>
            <div style={{display:"flex",alignItems:"stretch",marginLeft:8}}>
              {[["worksheet","Worksheet Generator"],["game","Fact Practice Game"]].map(([id,label])=>(
                <button key={id} onClick={()=>setPage(id)} style={{padding:"0 20px",background:"none",border:"none",borderBottom:`3px solid ${page===id?"#e17055":"transparent"}`,color:page===id?"#f5f1eb":"#5a5678",fontFamily:"'DM Sans',sans-serif",fontSize:13,cursor:"pointer",fontWeight:page===id?600:400,transition:"all .15s",marginBottom:"-1px"}}>
                  {label}
                </button>
              ))}
            </div>
          </div>

          <div style={{display:"flex",flex:1,overflow:"hidden"}}>
            {page==="worksheet"?<WorksheetApp />:<MathGame />}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
